<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add New Student</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom Creative Dark Theme Styles */
    body {
        background-color: #0d0d1a; /* Even darker base */
        color: #e4e4e7;
        background-image: radial-gradient(#2a2a3e 1px, transparent 0);
        background-size: 40px 40px;
    }
    .neon-glow {
        box-shadow: 0 0 5px #a855f7, 0 0 10px #a855f7, 0 0 15px #c084fc;
        transition: all 0.3s ease-in-out;
    }
    .neon-glow:hover {
        box-shadow: 0 0 10px #a855f7, 0 0 20px #a855f7, 0 0 30px #c084fc;
    }
    .dark-card {
        background-color: rgba(32, 32, 50, 0.7); /* Glassmorphism transparency */
        backdrop-filter: blur(5px);
        border: 1px solid rgba(168, 85, 247, 0.3); /* Purple border */
        border-top: 4px solid #a855f7;
    }
    .input-dark {
        background-color: rgba(13, 13, 26, 0.5); /* Semi-transparent input */
        border-color: #3b3b55;
        color: #e4e4e7;
    }
    .input-dark:focus {
        border-color: #a855f7;
        box-shadow: 0 0 0 1px #a855f7;
    }
    .hover-scale:hover {
        transform: scale(1.01);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center px-4 py-8">

  <div class="dark-card shadow-2xl rounded-xl p-8 max-w-lg w-full transform transition-all hover-scale">
    <h2 class="text-3xl font-bold mb-8 text-center text-purple-300 border-b border-[#3b3b55] pb-3">‚ûï Register New Student Profile</h2>

    <div class="p-4 mb-6 rounded-lg bg-indigo-900/30 border border-indigo-700/50">
        <h3 class="text-lg font-bold text-indigo-300 mb-2 flex items-center gap-2">
            üß¨ Face Model Training
        </h3>
        <ul class="list-disc list-inside text-sm text-indigo-300/80 space-y-1 ml-4">
            <li>Ensure all fields are accurate for record integrity.</li>
            <li><b>Upload Photo:</b> The image should be a clear, high-resolution, forward-facing shot for optimal face embedding generation.</li>
            <li>Submission creates the student record and trains the facial recognition model.</li>
        </ul>
    </div>
    <div id="messageBox" class="hidden p-4 mb-6 rounded-lg font-medium text-center shadow-md animate-fadeIn"></div>

    <form id="studentForm" enctype="multipart/form-data" class="space-y-5">
      
      <div class="space-y-4">
        <div>
          <label class="block font-semibold text-gray-300 mb-1">Name</label>
          <input type="text" name="name" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>

        <div>
          <label class="block font-semibold text-gray-300 mb-1">Student ID (Unique Identifier)</label>
          <input type="text" name="id" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold text-gray-300 mb-1">Program</label>
          <input type="text" name="program" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>

        <div>
          <label class="block font-semibold text-gray-300 mb-1">Branch</label>
          <input type="text" name="branch" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block font-semibold text-gray-300 mb-1">Mobile</label>
          <input type="text" name="mobile" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>

        <div>
          <label class="block font-semibold text-gray-300 mb-1">Email</label>
          <input type="email" name="email" required class="input-dark w-full rounded-lg px-4 py-2 focus:ring-purple-500 transition duration-300 hover:shadow-sm">
        </div>
      </div>

      <div class="pt-4 border-t border-[#3b3b55]">
        <label class="block font-semibold text-gray-300 mb-2">Upload Profile Photo (Crucial for Recognition)</label>
        <input type="file" name="photo" accept="image/*" required class="input-dark w-full rounded-lg px-4 py-2 file:mr-4 file:py-1 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-purple-800 file:text-white hover:file:bg-purple-700 transition shadow-inner" onchange="previewImage(event)">
      </div>

      <div class="text-center p-3 bg-gray-900/50 rounded-lg border border-dashed border-purple-500/50 transform transition-all duration-300">
        <img id="imagePreview" src="" alt="Preview" class="max-w-xs mx-auto mt-2 rounded-lg shadow-xl hidden border-2 border-purple-500 transform transition-all duration-500" />
        <p id="previewText" class="text-sm text-gray-400 mt-2">Photo preview will appear here.</p>
      </div>

      <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-indigo-500 text-white font-bold text-lg py-3 rounded-lg hover:opacity-95 transition shadow-lg transform hover:scale-[1.01] neon-glow">
        üì• SUBMIT STUDENT & TRAIN MODEL
      </button>
    </form>

    <div class="mt-6 text-center">
      <a href="/" class="text-purple-400 hover:text-purple-300 hover:underline font-medium flex items-center justify-center gap-2 transition duration-300 transform hover:translate-x-1">
        <span class="text-xl">‚¨ÖÔ∏è</span> Back to Attendance Home
      </a>
    </div>
  </div>

  <script>
    function previewImage(event) {
      const preview = document.getElementById('imagePreview');
      const text = document.getElementById('previewText');
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          preview.src = reader.result;
          preview.classList.remove('hidden');
          text.classList.add('hidden');
          preview.classList.add('animate-fadeIn'); // Added animation on load
        };
        reader.readAsDataURL(file);
      } else {
        preview.classList.add('hidden');
        text.classList.remove('hidden');
        preview.classList.remove('animate-fadeIn');
      }
    }

    document.getElementById("studentForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      const response = await fetch("/submit_student", {
        method: "POST",
        body: formData
      });

      const text = await response.text();
      showMessage(text.includes("success") ? "‚úÖ Student profile successfully created and model updated!" : "‚ùå " + text, text.includes("success"));
      
      if (text.includes("success")) form.reset();
      // Reset preview after form reset
      document.getElementById('imagePreview').classList.add('hidden');
      document.getElementById('imagePreview').src = '';
      document.getElementById('previewText').classList.remove('hidden');
    });

    function showMessage(msg, success) {
      const box = document.getElementById("messageBox");
      box.textContent = msg;
      box.className = "p-4 mb-6 rounded-lg font-medium text-center shadow-md animate-fadeIn";
      if (success) {
        box.classList.add("bg-green-900/40", "text-green-300", "border", "border-green-600/50", "animate-wiggle-once");
        box.classList.remove("bg-red-900/40", "text-red-300", "border-red-600/50");
      } else {
        box.classList.add("bg-red-900/40", "text-red-300", "border", "border-red-600/50", "animate-shake");
        box.classList.remove("bg-green-900/40", "text-green-300", "border-green-600/50");
      }
      box.classList.remove("hidden");
    }
  </script>
</body>
</html>
